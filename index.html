<!DOCTYPE html>
<html lang="en">
  <head>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8"> 
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>SPARQL Query Editor</title>
    
    <script src="js/vendor/jquery-1.9.1.js"></script>
    
    <script src="js/vendor/bootstrap/3.1.1/bootstrap.min.js"></script>
    <link rel="stylesheet" href="js/vendor/bootstrap/3.1.1/bootstrap.min.css">
    <link rel="stylesheet" href="js/vendor/bootstrap/3.1.1/bootstrap-theme.min.css">
     
    <script src="js/vendor/underscore.min.js"></script>
    <script src="js/vendor/backbone.min.js"></script>

    <script src="js/vendor/codemirror-4.1/lib/codemirror.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/vendor/codemirror-4.1/addon/selection/active-line.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/vendor/codemirror-4.1/addon/display/placeholder.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="js/vendor/codemirror-4.1/lib/codemirror.css" />
    <script src="js/vendor/codemirror-4.1/mode/javascript/javascript.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/vendor/codemirror-4.1/mode/sparql/sparql.js" type="text/javascript" charset="utf-8"></script>

    <script src="js/vendor/spin.min.js"></script>
    
    <script src="js/geoknow/query-editor.js"></script>

    <link rel="stylesheet" href="css/index.css" />

  </head>
  
  <body>
  <div id="top-container" class="container-fluid">
    
    <div id="header" class="row"></div>

    <div id="main-content" class="row">

      <div id="query-pane" class="pane col-xs-5"><div class="panel panel-default">
        
        <div class="panel-heading">
          <span class="title">Query</span>
        </div>
        
        <div class="panel-body">
          <form id="query-form">
            <input type="hidden" name="op" id="input-op" value="download" />
            
            <div id="target-form-group" class="form-group">
              <label for="input-graph_uri">Target:</label>
              <select id="input-graph_uri" class="form-control" name="graph_uri"></select>
            </div>

            <div id="query-form-group" class="form-group">
              <label for="input-query">Enter SPARQL query: </label>
              <textarea id="input-query" class="form-control hidden" name="query"></textarea>
              <div id="query-editor"></div>
              <p class="help-block">If you need a quickstart, you can load an example.
                 <a id="example_query-control-toggle" class="btn btn-link" href="#"></a></p>
            </div>

            <div id="example_query-form-group" class="form-group"> 
              <label for="input-example_query">Pick an example: </label>
              <div class="input-group">
                <select id="input-example_query" class="form-control" name="example_query"></select>
                <button id="input-load_example_query" class="btn btn-default" type="button">Load it!</button>
              </div>
            </div>

            <div id="result_format-form-group" class="form-group">
              <label for="input-result_format">Result format: </label>
              <select id="input-result_format" class="form-control" name="result_format" data-default-value="text/html"></select>
            </div>

            <div>
              <button id="input-reset" class="btn btn-default btn-sm">
                <!--<span class="glyphicon glyphicon-arrow-left"></span>--> Reset
              </button>
              <button id="input-submit-download" class="btn btn-primary btn-sm">
                <!--<span class="glyphicon glyphicon-arrow-down"></span>--> Download
              </button>
              <button id="input-submit-preview" class="btn btn-primary btn-sm">
                <!--<span class="glyphicon glyphicon-arrow-right"></span>--> Preview
              </button>
              <span id="preview-spinner"></span>
            </div>

          </form>
        </div> <!-- .panel-body -->

      </div></div> <!-- .panel --><!-- #query-pane -->

      <div id="results-pane" class="pane col-xs-7"><div class="panel panel-default">
        
        <div id="results-pane-heading" class="panel-heading">
          <span class="title">Preview</span>
          <span class="summary"></span>
        </div>
        
        <div id="results-pane-body" class="panel-body">
          <div id="results-container">
            <div id="results-caption"></div>
            <div id="results-body"></div>
          </div>
        </div>

      </div></div> <!-- .panel --><!-- #results-pane -->
    
    </div>
    
    <div id="footer" class="row">
    </div>
     
  </div> <!-- #top-container -->

  <iframe id="download-iframe" name="download-iframe" src="about:blank" >
  </iframe>  

  </body>
 
  <div class="undescore-template hidden" id="form-group-input-text-template">
    <div id="{{name}}-form-group" class="form-group">
      <label for="input-{{name}}">{{label}}:</label>
      <input type="text" name="{{name}}" id="input-{{name}}" class="form-control" />
    </div>
  </div>
  
  <div class="undescore-template hidden" id="results-success-caption-template">
    <p>
       Viewing <strong>{{count}}</strong> records as <code>{{format}}</code>. 
       Processed in {{timeTaken}} s.
    </p>
  </div>

  <div class="undescore-template hidden" id="results-success-heading-template">
    <span>({{count}} of {{countTotal}} records)</span>
  </div>
  
  <div class="undescore-template hidden" id="results-error-heading-template">
    <span>(failed)</span>
  </div>

  <div class="undescore-template hidden" id="results-error-caption-template">
    <div class="alert alert-danger alert-dismissable">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
      <strong>Error!</strong> <span>{{message}}</span>
    </div>
  </div>

</html>

<script type="text/javascript">

// Setup theme-specific parts (stylesheets, page headers)

$(document).ready(function () {
    
    var THEME_NAME = 'geodata'
    
    $('body').addClass('theme-' + THEME_NAME)

    var $link = $('<link>')
        .attr('rel', 'stylesheet')
        .attr('href', 'css/themes/' + THEME_NAME + '/style.css')
    $('head').append($link)

    var header_tpl = 'templates/themes/' + THEME_NAME + '/header.html'
    $.get(header_tpl)
        .done(function (data) {
            var header = _.template(data)({ 
                title: 'SPARQL Query Editor',
                headerLine: 'geoknow-server.imis.athena-innovation.gr',
            }) 
            $('#header').append($(header))
        })
        .fail(function () {
            console.error('Failed to load markup for page header')
        })

})

// Main

$(document).ready(function () {
    
    geoknow.workspace = {};

    var g = geoknow.workspace;

    var p = geoknow.Query.initialize();

    p.done(function() {

        g.query = new geoknow.Query({ 
            query: '', 
        });

        g.pane1 = new geoknow.QueryFormView({
            model: g.query,
            el: '#query-pane',
        });

        g.pane2 = new geoknow.QueryResultView({
            model: g.query,
            el: '#results-pane',
        });

    });

});

</script>
